<?xml version="1.0"?>

<project name="localJava" default="compile" basedir=".">

  <property name="localJava.styleDir"                location="${basedir}/html" />
  <property name="localJava.srcDir"                  location="${basedir}/isb" />
  <property name="localJava.docsDir"                 location="${basedir}/docs" />
  <property name="localJava.extLibDir"               location="${basedir}/extlib" />
  <property name="localJava.buildDir"                location="${projBuildDir}" />
  <property name="localJava.classesDir"              location="${projClassesDir}" />
  <property name="localJava.javadocDir"              location="${projWebDir}/javadoc" />

  <property name="localJava.sourceCompileFlag"       value="1.4" />

  <property name="localJava.jarFile"                 location="${localJava.buildDir}/isb.jar" />
  <property name="localJava.srcFile"                 location="${localJava.buildDir}/isb-src.tar.gz" />

  <path id="localJava.classpath">
    <pathelement location="${localJava.classesDir}" />
    <fileset dir="${localJava.extLibDir}"> 
      <include name="*.jar" />
    </fileset>
  </path>

  <target name="style">
    <mkdir dir="${localJava.styleDir}" />
    <style basedir="${localJava.docsDir}" 
           destdir="${localJava.styleDir}" 
           includes="*.xml" 
           style="${docsStyleSheet}" />
  </target>

  <target name="copyResources">
    <copy todir="${localJava.classesDir}">
      <fileset dir="${basedir}">
        <include name="**/*.xml" />
        <include name="**/*.dtd" />
        <exclude name="**/tp/*" />
        <exclude name="docs/*.xml" />
        <exclude name="build.xml" />
      </fileset>
    </copy>
  </target>

  <target name="buildWeb" depends="style, javadoc" />
  
  <target name="javadoc">
    <mkdir dir="${localJava.javadocDir}" />
    <javadoc source="${localJava.sourceCompileFlag}" 
             Overview="${localJava.styleDir}/overview.html" 
             sourcepath="${basedir}" 
             destdir="${localJava.javadocDir}"
             packageList="${basedir}/packageList.txt"
             additionalparam="-breakiterator"> 
      <classpath refid="localJava.classpath" />
    </javadoc>
  </target>

  <target name="compile">
    <mkdir dir="${localJava.classesDir}" />
    <javac srcdir="${localJava.srcDir}" 
           destdir="${localJava.classesDir}" 
           source="${localJava.sourceCompileFlag}" 
           debug="on" 
           excludes="**/tp/*.java">
      <classpath refid="localJava.classpath" />
    </javac>
  </target>

  <target name="compiletests" depends="compile">
    <mkdir dir="${localJava.classesDir}" />
    <javac srcdir="${localJava.srcDir}" 
           destdir="${localJava.classesDir}" 
           source="${localJava.sourceCompileFlag}" 
           debug="on" 
           includes="**/tp/*.java" />
  </target>  
 
  <target name="srctar">
    <tar destfile="${localJava.srcFile}" 
         basedir="${basedir}"
         includes="**/*.java,**/*.xml,**/.dtd" 
         compression="gzip">
    </tar>
  </target>

  <target name="build" depends="jar, srctar" />

  <target name="jar" depends="clean, compile, copyResources">
    <mkdir dir="${localJava.buildDir}" />
    <jar basedir="${localJava.classesDir}" destfile="${localJava.jarFile}">
      <fileset dir="${localJava.classesDir}">
        <include name="**/*.class" />
        <include name="**/*.xml" />
        <include name="**/*.dtd" />
        <exclude name="**/tp/*.class" />
      </fileset>
    </jar>
  </target>

  <target name="clean">
    <delete dir="${localJava.styleDir}" quiet="yes" />
    <delete quiet="yes">
      <fileset dir="${localJava.srcDir}">
        <include name="**/*.class" />
      </fileset>
    </delete>
    <delete dir="${localJava.buildDir}" quiet="yes" />
    <delete quiet="yes">
      <fileset dir="${localJava.classesDir}">
        <include name="**/*.class" />
        <include name="**/*.xml" />
        <include name="**/*.dtd" />
      </fileset>
    </delete>
  </target>

  <target name="distClean" depends="clean">
    <delete dir="${projClassesDir}" quiet="yes" />
  </target>
  
</project>
